import os
import zipfile
import csv
import logging

# Configure logging
logging.basicConfig(
    filename="debug_log.txt",
    level=logging.DEBUG,
    format="%(asctime)s - %(levelname)s - %(message)s",
)

# Function to check if a folder contains a PDF

def check_for_pdf(folder_path):
    for root, _, files in os.walk(folder_path):
        for file in files:
            if file.lower().endswith(".pdf"):
                return True
    return False

# Function to search through a zipped folder without extracting

def search_zip_for_pdfs(zip_path, external_ids):
    results = []
    try:
        with zipfile.ZipFile(zip_path, "r") as zip_ref:
            # List all files and folders in the zip archive
            zip_files = zip_ref.namelist()

            logging.info(f"Total files in zip: {len(zip_files)}")

            for ext_id in external_ids:
                has_pdf = False
                matching_files = []

                for file in zip_files:
                    if ext_id in file:
                        matching_files.append(file)
                        if file.lower().endswith(".pdf"):
                            has_pdf = True

                # Log debug information for each ExternalId
                logging.debug(
                    f"ExternalId: {ext_id}, Matching Files: {matching_files}, Has PDF: {has_pdf}"
                )

                results.append(
                    {
                        "ExternalId": ext_id,
                        "HasPDF": "Yes" if has_pdf else "No",
                        "MatchingFiles": ", ".join(matching_files) if matching_files else "None",
                    }
                )

        logging.info("Finished scanning zip file.")
    except Exception as e:
        logging.error(f"Error reading zip file: {e}")
        raise

    return results
# Path to the zipped walkthrough folder
zipped_folder_path = r"C:\Users\Micha\Walkthrough.zip"

# List of external IDs
external_ids = [
    "17-1085N",
    "17-1084",
    "17-1391",
    "17-0348",
    "17-1322",
    "17-0272",
    "17-1321",
    "17-0271",
    "17-0042",
    "17-1392",
    "17-1393",
    "17-1022",
    "17-0793",
    "17-0321",
    "17-0826",
    "17-0826N",
    "17-1247",
    "17-0274",
    "17-0274N",
    "17-1143",
    "17-0829",
    "17-0429",
    "17-0633",
    "17-0030",
    "17-0901",
    "17-1325",
    "17-1025",
    "17-0184",
    "17-1174",
    "17-0942",
    "17-1024",
    "17-1026",
    "17-1089",
    "17-1089S",
    "17-1312",
    "17-1088",
    "17-1395",
    "17-0270",
    "17-1028",
    "17-0041",
    "17-1090",
    "17-0221",
    "17-0221W",
    "17-0446",
    "17-0126",
    "17-0126N",
    "17-0079",
    "17-0239",
    "17-0422E",
    "17-1125",
    "17-0255",
    "17-0255N",
    "17-0746",
    "17-0740",
    "17-1344",
    "17-0484",
    "17-0802",
    "17-0242",
    "17-0498",
    "17-1397",
    "17-1398",
    "17-1399",
    "17-0990",
    "17-0857",
    "17-0201",
    "17-0201N",
    "17-0019",
    "17-0716",
    "17-0465",
    "17-0466",
    "17-1254",
    "17-0408",
    "17-0409",
    "17-1020",
    "17-0904",
    "17-1110",
    "17-0166",
    "17-1349",
    "17-1278",
    "17-1262",
    "17-1275",
    "17-1274",
    "17-1314",
    "17-1079",
    "17-1272",
    "17-1271",
    "17-1269",
    "17-1268",
    "17-1270",
    "17-1313",
    "17-1266",
    "17-0488",
    "17-0487",
    "17-1288",
    "17-1287",
    "17-1286",
    "17-1285",
    "17-1295",
    "17-1284",
    "17-1283",
    "17-1282",
    "17-1281",
    "17-1280",
    "17-1436",
    "17-1294",
    "17-1293",
    "17-1292",
    "17-1291",
    "17-1290",
    "17-1265",
    "17-1264",
    "17-1263",
    "17-0449",
    "17-0445",
    "17-0436",
    "17-1289",
    "17-0734",
    "17-0735",
    "17-0258",
    "17-0729",
    "17-1353",
    "17-1086",
    "17-1032",
    "17-1390",
    "17-1323",
    "17-1320",
    "17-1432",
    "17-1433",
    "17-1434",
    "17-1435",
    "17-0763",
    "17-0633W",
    "17-1326",
    "17-1327",
    "17-0221S",
    "17-1409",
    "17-1318",
    "17-0708",
    "17-0709",
    "17-0711",
    "17-0712",
    "17-1310",
    "17-1311",
    "17-0724",
    "17-0725",
    "17-0237",
    "17-0236",
    "17-0238",
    "17-0718",
    "17-0249",
    "17-0342",
    "17-0937",
    "17-0938",
    "17-1438",
    "17-1423",
    "17-1424",
    "17-1425",
    "17-1426",
    "17-1427",
    "17-1428",
    "17-1429",
    "17-1430",
    "17-0890",
    "17-0907",
    "17-0941",
    "17-0792",
    "17-0552",
    "17-0564",
    "17-0080",
    "17-0568",
    "17-0536",
    "17-0557",
    "17-0556",
    "17-0541",
    "17-0558",
    "17-0858",
    "17-0561",
    "17-0566",
    "17-1317",
    "17-0559",
    "17-0538",
    "17-0537",
    "17-0528",
    "17-0532",
    "17-0565",
    "17-0555",
    "17-0560",
    "17-0539",
    "17-0567",
    "17-0551",
    "17-0530",
    "17-0526",
    "17-0549",
    "17-0569",
    "17-0547",
    "17-0531",
    "17-0563",
    "17-1403",
    "17-1404",
    "17-1150",
    "17-1152",
    "17-1153",
    "17-1149",
    "17-0952",
    "17-0920",
    "17-1151",
    "17-0035",
    "17-0120",
    "17-0480",
    "17-0689",
    "17-1250",
    "17-0902",
    "17-0903",
    "17-1249",
    "17-0825",
    "17-0171",
    "17-0032",
    "17-0172",
    "17-1083",
    "17-0955",
    "17-0959",
    "17-0961",
    "17-0960",
    "17-0965",
    "17-1019",
    "17-0962",
    "17-0964",
    "17-0963",
    "17-0966",
    "17-0958",
    "17-0967",
    "17-0957",
    "17-1415",
    "17-1416",
    "17-1394",
    "17-0803",
    "17-1045",
    "17-1046",
    "17-0320",
    "17-0572",
    "17-1035",
    "17-0717",
    "17-0796",
    "17-0797",
    "17-0798",
    "17-1109",
    "17-0755",
    "17-1334",
    "17-0761",
    "17-0425",
    "17-1329",
    "17-1335",
    "17-1338",
    "17-1330",
    "17-0759",
    "17-1332",
    "17-1331",
    "17-0760",
    "17-1333",
    "17-0758",
    "17-1336",
    "17-0084",
    "17-0084E",
    "17-0004",
    "17-0062",
    "17-1340",
    "17-0879",
    "17-0866",
    "17-1341",
    "17-1299",
    "17-0867",
    "17-0868",
    "17-0869",
    "17-0124",
    "17-0124N",
    "17-0124S",
    "17-0215",
    "17-0215W",
    "17-0053",
    "17-0870",
    "17-0871",
    "17-0052",
    "17-0872",
    "17-0046",
    "17-0873",
    "17-0240",
    "17-0240E",
    "17-0240W",
    "17-0260",
    "17-0005",
    "17-0220",
    "17-0054",
    "17-0878",
    "17-0231",
    "17-0875",
    "17-0874",
    "17-1306",
    "17-1301",
    "17-1303",
    "17-1304",
    "17-1305",
    "17-1302",
    "17-1300",
    "17-0009",
    "17-0003",
    "17-0248",
    "17-0876",
    "17-0865",
    "17-1107",
    "17-1106",
    "17-1047",
    "17-1048",
    "17-1245",
    "17-1246",
    "17-0836",
    "17-0877",
    "17-0917",
    "17-0933",
    "17-0934",
    "17-0935",
    "17-0926",
    "17-0927",
    "17-0928",
    "17-0929",
    "17-0930",
    "17-0931",
    "17-0932",
    "17-0936",
    "17-0924",
    "17-0925",
    "17-0125",
    "17-0125S",
    "17-0006",
    "17-1021",
    "17-1252",
    "17-0256",
    "17-0256W",
    "17-1104",
    "17-1387",
    "17-0832",
    "17-0100",
    "17-0365",
    "17-0230",
    "17-0738",
    "17-0413",
    "17-0069",
    "17-0069E",
    "17-0954",
    "17-0841",
    "17-0401",
    "17-0077",
    "17-0376",
    "17-0400",
    "17-0375",
    "17-0913",
    "17-0828",
    "17-0276",
    "17-1253",
    "17-0914",
    "17-1410",
    "17-1065",
    "17-1066",
    "17-1067",
    "17-1068",
    "17-1251",
    "17-1414",
    "17-1417",
    "17-1420",
    "17-1418",
    "17-0086",
    "17-0699",
    "17-1389",
    "17-1388",
    "17-0804",
    "17-0431",
    "17-1396",
    "17-1413",
    "17-0432",
    "17-0432Z",
    "17-1407",
    "17-1355",
    "17-0001",
    "17-0001E",
    "17-0001N",
    "17-0031",
    "17-0031E",
    "17-0031W",
    "17-0726",
    "17-1039",
    "17-1406",
    "17-0799",
    "17-1437",
    "17-0915",
    "17-1316",
    "17-1422",
    "17-0414",
    "17-0422",
    "17-0122",
    "17-1027",
    "17-1004",
    "17-0944",
    "17-1328",
    "17-1129",
    "17-0364",
    "17-0223",
    "17-0323",
    "17-0521",
    "17-0442",
    "17-0033",
    "17-1307",
    "17-0523",
    "17-0522",
    "17-1419",
    "17-0353",
    "17-1087",
    "17-1412",
    "17-0197",
    "17-0214",
    "17-0123",
    "17-0123W",
    "17-0440",
    "17-0045",
    "17-0045E",
    "17-0435",
    "17-0008",
    "17-0464",
    "17-1108",
    "17-0402",
    "17-0232",
    "17-0130",
    "17-0179",
    "17-0179Z",
    "17-1036",
    "17-0403",
    "17-0403S",
    "17-1103",
    "17-1142",
    "17-0953",
    "17-0116",
    "17-0026",
    "17-0012",
    "17-0043",
    "17-0002",
    "17-0010",
    "17-0014",
    "17-0026E",
    "17-0018",
    "17-1346",
    "17-0090",
    "17-0212",
    "17-0275",
    "17-0059",
    "17-0059W",
    "17-0418",
    "17-0048",
    "17-0185",
    "17-0185S",
    "17-0028",
    "17-0028S",
    "17-0091",
    "17-0017",
    "17-0117",
    "17-0118",
    "17-0119",
    "17-0384",
    "17-0830",
    "17-1308",
    "17-0916",
    "17-0253",
    "17-1343",
    "17-0791",
    "17-0055",
    "17-0055E",
    "17-0187",
    "17-01871",
    "17-0076",
    "17-0178",
    "17-0178W",
    "17-0410",
    "17-0027",
    "17-0027E",
    "17-0382",
    "17-0447",
    "17-1069",
    "17-1072",
    "17-0040",
    "17-0040E",
    "17-0011",
    "17-0011E",
    "17-0011W",
    "17-0056",
    "17-0056N",
    "17-0056S",
    "17-1342",
    "17-0880",
    "17-0273",
    "17-0034",
    "17-0029",
    "17-1347",
    "17-0061",
    "17-0351",
    "17-1138",
    "17-1137",
    "17-1136",
    "17-1154",
    "17-0373",
    "17-0373W",
    "17-0051",
    "17-0550",
    "17-0235",
    "17-0851",
    "17-1113",
    "17-0352",
    "17-0121",
    "17-0448",
    "17-1127",
    "17-1111",
    "17-0152",
    "17-0152W",
    "17-0098",
    "17-0173",
    "17-0173S",
    "17-1128",
    "17-0213",
    "17-0050",
    "17-0366",
    "17-0831",
    "17-0383",
    "17-0950",
    "17-0437",
    "17-0744",
    "17-1139",
    "17-1134",
    "17-1135",
    "17-1345",
    "17-1279",
    "17-0347",
    "17-1277",
    "17-1276",
    "17-1273",
    "17-0443",
    "17-1267",
    "17-1348",
    "17-1296",
    "17-0444",
    "17-0343",
    "17-0370",
    "17-0370W",
    "17-0371",
    "17-0013",
    "17-0016",
    "17-0044",
    "17-0044N",
    "17-0266",
    "17-0015"
]

# Search for PDFs in the zipped folder
results = search_zip_for_pdfs(zipped_folder_path, external_ids)

# Write the results to a CSV file
output_csv_path = "output_results.csv"

try:
    with open(output_csv_path, mode="w", newline="", encoding="utf-8") as file:
        writer = csv.DictWriter(file, fieldnames=["ExternalId", "HasPDF", "MatchingFiles"])
        writer.writeheader()
        writer.writerows(results)
    logging.info(f"Results successfully written to {output_csv_path}")
except Exception as e:
    logging.error(f"Error writing results to CSV: {e}")
    raise

print(f"Results saved to {output_csv_path}. Check debug_log.txt for detailed information.")
